<center><h1>包的基本概念</h1></center>

---

Go 语言是使用包来组织源代码的，并实现命名空间的管理。任何源代码文件必须属于某个包。源码文件的第一行有效代码必须是 package pacakgeName 语句，通过该语句声明自己所在的包。

### 基本概念

Go 语言的包借助了目录树的组织形式，一般包的名称就是其源文件所在目录的名称，虽然 Go 没有强制包名必须和其所在的目录名同名，但还是建议包名和所在目录同名，这样结构更清晰。

包可以定义在很深的目录中，包的定义是不包括目录路径的，但是包的引用一般是全路径引用。比如在 \$GOPATH/src/a/b/ 下定义一个包 c。在包 c 的源码中只需声明为 package c，而不是声明为 package a/b/c，但是在“import”包 c 时，需要带上路径 import "a/b/c"。包的

包的习惯用法：

```
包名一般是小写的，使用一个简短的命名。
包名一般要和所在的目录同名。
包一般放到公司的域名目录下，这样能保证包名的唯一性，便于共享代码。比如个人的 GitHub 项目的包一般放到 $GOPATH/src/github.com/userName/projectName 目录下。
```

### 包引用

标准包的源码位于 $GOROOT/src/ 下面，标准包可以直接引用。自定义的包和第三方包的源码必须放到 $GOPATH/src 目录下才能被引用。

### 包引用路径

包的引用路径有两种写法，一种是全路径，另一种是相对路径。

### 全路径引用

包的绝对路径就是“$GOROOT/src 或 $GOPATH/src”后面包的源码的全路径，比如下面的包引用：

```go
import "lab/test"
import "database/sql/driver"
import "database/sql"
```

test 包是自定义的包，其源码位于$GOPATH/src/lab/test 目录下； sql 和 driver 包的源码分别位于 $GOROOT/src/database/sql 和 \$GOROOT/src/database/sql/driver 下。

### 相对路径引用

相对路径只能用于引用 $GOPATH 下的包，标准包的引用只能使用全路径引用。比如下面两个包：包 a 的路径是 $GOPATH/src/lab/a，包 b 的源码路径为 \$GOPATH/src/lab/b，假设 b 引用了 a 包，则可以使用相对路径引用方式。示例如下：

```go
// 相对路径引用
import "../a"
// 全路径引用
import "lab/a"
```

### 包引用格式

包引用有四种引用格式，为叙述方便，我们以 fmt 标准库为例进行说明。

#### 1) 标准引用方式如下

```go
import "fmt"
```

此时可以用“fmt.”作为前缀引用包内可导出元素，这是常用的一种方式。

#### 2) 别名引用方式如下

```go
import F "fmt"
```

此时相当于给包 fmt 起了个别名 F，用“F.”代替标准的“fmt.”作为前缀引用 fmt 包内可导出元素。

#### 3) 省略方式如下

```go
import . "fmt"
```

此时相当于把包 fmt 的命名空间直接合并到当前程序的命名空间中，使用 fmt 包内可导出元素可以不用前缀“fmt.”，直接引用。示例如下：

```go
package main
import . "fmt"
func main () {
    //不需要加前级 fmt.
    Println("hello , world!")
}
```

#### 4) 仅执行包初始化 init 函数

使用标准格式引用包，但是代码中却没有使用包，编译器会报错。如果包中有 init 初始化函数，则通过 import \_ "packageName" 这种方式引用包，仅执行包的初始化函数，即使包没有 init 初始化函数，也不会引发编译器报错。示例如下：

```go
import _ "fmt"
```

注意：

```
一个包可以有多个 init 函数，包加载会执行全部的 init 函数，但并不能保证执行顺序，所以不建议在一个包中放入多个 init 函数，将需要初始化的逻辑放到一个 init 函数里面。
包不能出现环形引用。比如包 a 引用了包 b，包 b 引用了包 c，如果包 c 又引用了包 a，则编译不能通过。
包的重复引用是允许的。比如包 a 引用了包 b 和包 c，包 b 和包 c 都引用了包 d。这种场景相当于重复引用了 d，这种情况是允许的，并且 Go 编译器保证 d 的 init 函数只会执行一次。
```

### 包加载

通过前面一系列的学习相信大家已经大体了解了 Go 程序的启动／加载过程，在执行 main.main 之前， Go 引导程序会先对整个程序的包进行初始化。整个执行的流程如下图所示。

<div align=center> 
    <img src="../../img/7-包/01-包的基本概念/Go 包的初始化.gif"/> 
    <p>图：Go 包的初始化</p>
</div>

Go 包的初始化有如下特点：

```
包初始化程序从 main 函数引用的包开始，逐级查找包的引用，直到找到没有引用其他包的包，最终生成一个包引用的有向无环图。
Go 编译器会将有向无环图转换为一棵树，然后从树的叶子节点开始逐层向上对包进行初始化。
单个包的初始化过程如上图所示，先初始化常量，然后是全局变量，最后执行包的 init 函数（如果有）。
```
